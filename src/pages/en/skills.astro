---
import { getCollection } from 'astro:content';
import TerminalLayout from '../../layouts/TerminalLayout.astro';
import SkillBar from '../../components/SkillBar.astro';
import { getTranslations } from '../../i18n/utils';

const lang = 'en';
const t = getTranslations(lang);
const currentPath = Astro.url.pathname;

const skillEntries = await getCollection('skills');
const groupedSkills = skillEntries.reduce((acc, entry) => {
  acc[entry.data.category] = entry.data.items;
  return acc;
}, {} as Record<string, Array<{ name: string; years: number | null | undefined }>>);

const categoryOrder = ['language', 'frontendFramework', 'backendFramework', 'database', 'test', 'infrastructure', 'saas'];
const sortedCategories = categoryOrder.filter(cat => cat in groupedSkills);

const getCategoryName = (category: string) => {
  return t.skillCategories[category as keyof typeof t.skillCategories] || category;
};

const formatYears = (years: number | null | undefined): string => {
  if (years === null || years === undefined) return '';
  if (years === 0) return '<1';
  return `${years}+`;
};
---

<TerminalLayout
  title={t.pages.skills.title}
  description={t.meta.description}
  lang={lang}
  currentPath={currentPath}
>
  <section class="skills-content">
    <div class="prompt">{t.pages.skills.prompt}</div>

    <div class="skills-grid">
      {sortedCategories.map((category) => (
        <div class="skill-card">
          <div class="card-header">
            <span class="card-title">{getCategoryName(category)}</span>
          </div>
          <div class="card-content">
            {groupedSkills[category].map((skill) => (
              <SkillBar name={skill.name} years={formatYears(skill.years)} />
            ))}
          </div>
        </div>
      ))}
    </div>

    <div class="cursor">$ <span class="blink">_</span></div>
  </section>
</TerminalLayout>

<style>
  .skills-content {
    max-width: 900px;
  }

  .prompt {
    color: var(--accent-secondary);
    margin-bottom: 1.5rem;
  }

  .skills-grid {
    display: grid;
    gap: 1.5rem;
  }

  .skill-card {
    background-color: var(--bg-secondary);
    border-radius: 4px;
    padding: 1rem;
  }

  .card-header {
    margin-bottom: 0.75rem;
  }

  .card-title {
    color: var(--accent-primary);
    font-weight: 500;
    font-size: 0.875rem;
  }

  .card-content {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .cursor {
    color: var(--text-primary);
    margin-top: 2rem;
  }

  .blink {
    animation: blink 1s step-end infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
</style>
